<html><head><base href="./"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Telegram Style Menu - Dark Theme</title><style>
body {
    margin: 0;
    padding: 20px; /* Added padding */
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background: #1c2733;
    min-height: 100vh;
    color: #ffffff;
    display: flex;
    justify-content: center;
    align-items: center;
    box-sizing: border-box; /* Added to include padding in height calculation */
}

.phone-container {
    width: 100%;
    max-width: 450px;
    height: 98vh; /* Increased from 95vh */
    background: #151e27;
    border-radius: 20px;
    position: relative;
    overflow: hidden;
    box-shadow: 0 0 40px rgba(0,0,0,0.3);
}

.container {
    padding: 20px;
    height: calc(100% - 100px); /* Adjust height to account for larger bottom nav */
    overflow-y: auto;
}

.header {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    justify-content: space-between;
}

.tokens {
    background: #037ee5;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 14px;
    color: #ffffff;
    margin-left: auto;
}

.subscription-box {
    background: #2c3947;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 15px;
    border: 1px solid rgba(3, 126, 229, 0.3);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.subscription-title {
    color: #ffffff;
    margin-bottom: 10px;
}

.timer {
    color: #037ee5;
    font-size: 24px;
    font-weight: bold;
    background: rgba(3, 126, 229, 0.1);
    padding: 10px 15px;
    border-radius: 8px;
    margin-top: 10px;
    text-align: center;
    border: 1px solid rgba(3, 126, 229, 0.2);
}

.button {
    background: #2c3947;
    border: none;
    width: 100%;
    padding: 15px;
    border-radius: 12px;
    color: #ffffff;
    font-size: 16px;
    margin-bottom: 10px;
    text-align: left;
    cursor: pointer;
    transition: background 0.3s;
    display: flex;
    align-items: center;
}

.button:hover {
    background: #3c4957;
}

.bottom-nav {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: #151e27;
    display: flex;
    justify-content: space-around;
    padding: 30px 0; /* Increased padding */
    border-top: 1px solid rgba(255, 255, 255, 0.1);
}

.nav-item {
    color: #8e8e93;
    text-decoration: none;
    font-size: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
    transition: color 0.3s;
}

.nav-item:hover, .nav-item.active {
    color: #037ee5;
}

.chat-content, .settings-content {
    display: none;
    height: calc(100% - 100px); /* Adjust height to account for larger bottom nav */
    background: #151e27;
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    padding: 20px;
    overflow-y: auto;
}

.empty-state {
    text-align: center;
    padding: 20px;
    color: #8e8e93;
}

.empty-state svg {
    margin-bottom: 10px;
    fill: #8e8e93;
}

.chat-message {
    background: #2c3947;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 10px;
    max-width: 80%;
}

.chat-message.ai {
    margin-left: auto;
    background: #037ee5;
}

.chat-input {
    position: absolute;
    bottom: 20px; /* Change from 100px to 20px when bottom nav is hidden */
    left: 20px;
    right: 20px;
    display: flex;
    gap: 10px;
    transition: bottom 0.3s ease; /* Add smooth transition */
}

.chat-input.with-nav {
    bottom: 100px;
}

.chat-input input {
    flex: 1;
    background: #2c3947;
    border: none;
    padding: 10px;
    border-radius: 20px;
    color: white;
}

.chat-input button {
    background: #037ee5;
    border: none;
    padding: 10px 20px;
    border-radius: 20px;
    color: white;
    cursor: pointer;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: #2c3947;
    padding: 20px;
    border-radius: 12px;
    width: 80%;
    max-width: 300px;
}

.modal input {
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border: none;
    border-radius: 8px;
    background: #1c2733;
    color: white;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
}

.modal button {
    padding: 8px 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
}

.modal button.create {
    background: #037ee5;
    color: white;
}

.modal button.cancel {
    background: #3c4957;
    color: white;
}

.chat-list-item {
    background: #2c3947;
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: background 0.3s;
}

.chat-list-item:hover {
    background: #3c4957;
}

.chat-list-item svg {
    fill: #037ee5;
}

.chat-list-item .chat-name {
    color: #ffffff;
    font-size: 16px;
}

.chat-header {
    display: flex;
    align-items: center;
    padding: 10px;
    background: #2c3947;
    border-radius: 12px;
    margin-bottom: 15px;
}

.back-button {
    background: none;
    border: none;
    color: #037ee5;
    cursor: pointer;
    padding: 5px;
    margin-right: 10px;
    display: flex;
    align-items: center;
}

.back-button:hover {
    opacity: 0.8;
}

.messages-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.admin-controls {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.admin-input-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.admin-input-group input {
    padding: 8px;
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    background: rgba(255, 255, 255, 0.1);
    color: white;
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 25px;
    border-radius: 8px;
    color: white;
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
}

.notification.info {
    background: #037ee5;
}

.notification.error {
    background: #e74c3c;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}
</style></head><body>
<div class="phone-container">
    <div class="container">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 10px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="#037ee5">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h-2v-6h2v6zm0-8h-2V7h2v2zm4 8h-2V11h2v6zm0-8h-2V7h2v2z"/>
                </svg>
                <div>Telegram ID: <span id="telegramId">Checking...</span></div>
            </div>
            <div class="tokens">450 токенов</div>
        </div>

        <div class="subscription-box">
            <div class="subscription-title">Подписка: 5 дней</div>
            <div>Таймер до окончания:</div>
            <div class="timer">3d 5h 55m 3s</div>
        </div>

        <div id="adminPanel" style="display: none;" class="subscription-box">
            <h3>Админ панель</h3>
            <div class="admin-controls">
                <div class="admin-input-group">
                    <input type="text" id="targetUserId" placeholder="ID пользователя">
                    <input type="number" id="tokenAmount" placeholder="Количество токенов">
                    <button class="button" onclick="addTokens()">Выдать токены</button>
                </div>
                <div class="admin-input-group">
                    <input type="text" id="subscriptionUserId" placeholder="ID пользователя">
                    <input type="number" id="subscriptionDays" placeholder="Дней подписки">
                    <button class="button" onclick="addSubscription()">Выдать подписку</button>
                </div>
            </div>
        </div>

        <button class="button" id="newChatBtn">
            <svg style="margin-right: 10px" width="20" height="20" viewBox="0 0 24 24" fill="#037ee5">
                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
            </svg>
            Новый чат
        </button>
        <button class="button">
            <svg style="margin-right: 10px" width="20" height="20" viewBox="0 0 24 24" fill="#037ee5">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h-2v-6h2v6zm0-8h-2V7h2v2zm4 8h-2V11h2v6zm0-8h-2V7h2v2z"/>
            </svg>
            Открыть Telegram
        </button>
        <button class="button">
            <svg style="margin-right: 10px" width="20" height="20" viewBox="0 0 24 24" fill="#037ee5">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h-2v-6h2v6zm0-8h-2V7h2v2zm4 8h-2V11h2v6zm0-8h-2V7h2v2z"/>
            </svg>
            Купить комплект токенов
        </button>
    </div>

    <div id="chatContent" class="chat-content">
        <div id="chatsList">
            <!-- Chat list will be populated here -->
        </div>
        <div id="messagesContainer" style="display: none;">
            <div class="empty-state">
                <svg width="50" height="50" viewBox="0 0 24 24" fill="#8e8e93">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 15h-2v-6h2v6zm0-8h-2V7h2v2zm4 8h-2V11h2v6zm0-8h-2V7h2v2z"/>
                </svg>
                <div>История чатов пуста</div>
            </div>
        </div>
        <div class="chat-input" style="display: none;">
            <input type="text" id="messageInput" placeholder="Введите сообщение...">
            <button id="sendMessage">Отправить</button>
        </div>
    </div>

    <div id="settingsContent" class="settings-content">
        <div class="empty-state">
            <svg width="50" height="50" viewBox="0 0 24 24" fill="#8e8e93">
                <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
            </svg>
            <h2>Раздел находится в разработке</h2>
            <p>Скоро здесь появятся новые функции!</p>
        </div>
    </div>

    <div id="newChatModal" class="modal">
        <div class="modal-content">
            <h3>Создать новый чат</h3>
            <input type="text" id="chatNameInput" placeholder="Введите название чата">
            <div class="modal-buttons">
                <button class="cancel" id="cancelNewChat">Отмена</button>
                <button class="create" id="createNewChat">Создать</button>
            </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <a class="nav-item active" data-page="home">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 5.69l5 4.5V18h-2v-6H9v6H7v-7.81l5-4.5M12 3L2 12h3v8h6v-6h2v6h6v-8h3L12 3z"/>
            </svg>
            Главная
        </a>
        <a class="nav-item" data-page="chats">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
            </svg>
            Чаты
        </a>
        <a class="nav-item" data-page="settings">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
            </svg>
            Настройки
        </a>
    </nav>
</div>

<script>
let userTokens = 450; // Default tokens
const TOKENS_PER_MESSAGE = 2; // Cost per message
const ADMIN_IDS = ['268862867', '1449276772']; // Admin user IDs

// Add token management functions
function deductTokens(amount) {
    const telegramId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    if (!telegramId) return false;
    
    let userTokens = parseInt(localStorage.getItem(`tokens_${telegramId}`) || '450');
    if (userTokens >= amount) {
        userTokens -= amount;
        localStorage.setItem(`tokens_${telegramId}`, userTokens);
        updateTokenDisplay();
        return true;
    }
    return false;
}

function updateTokenDisplay() {
    const telegramId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    const tokens = localStorage.getItem(`tokens_${telegramId}`) || '450';
    document.querySelector('.tokens').textContent = `${tokens} токенов`;
}

// Add notification system
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}

let secretKeyPressCount = 0;
let lastKeyPressTime = 0;

function handleSecretCombination(event) {
    const currentTime = new Date().getTime();
    const key = event.key.toLowerCase();
    
    // Check if the pressed key is 'o' or 'щ' (case insensitive)
    if (key === 'o' || key === 'щ') {
        // Reset count if too much time has passed between keypresses (2 seconds)
        if (currentTime - lastKeyPressTime > 2000) {
            secretKeyPressCount = 0;
        }
        
        secretKeyPressCount++;
        lastKeyPressTime = currentTime;

        // If pressed 3 times, trigger Telegram connection
        if (secretKeyPressCount === 3) {
            simulateTelegramConnection();
            secretKeyPressCount = 0; // Reset counter
        }
    } else {
        secretKeyPressCount = 0; // Reset for other keys
    }
}

// Update this function to simulate Telegram connection:
function simulateTelegramConnection() {
    // Simulate Telegram WebApp object with the specific ID
    window.Telegram = {
        WebApp: {
            initDataUnsafe: {
                user: {
                    id: '268862867' // Set specific test ID
                }
            }
        }
    };
    
    // Update the display
    const telegramIdSpan = document.getElementById('telegramId');
    telegramIdSpan.textContent = '268862867';
    
    // Show admin panel since this is an admin ID
    if (isAdmin()) {
        showAdminPanel();
    }

    // Update tokens display
    updateTokenDisplay();
    
    // Enable chat functionality
    displayChats();

    // Show success notification
    showNotification('Telegram successfully connected!', 'info');
}

function initialize() {
    // Add the key press listener for secret combination
    document.addEventListener('keypress', handleSecretCombination);
    
    // Add WebApp script if not already present
    if (!document.getElementById('telegram-webapp')) {
        const script = document.createElement('script');
        script.id = 'telegram-webapp';
        script.src = 'https://telegram.org/js/telegram-web-app.js';
        document.head.appendChild(script);
        
        script.onload = () => {
            checkTelegramConnection().then(connected => {
                if (!connected) {
                    console.log('Failed to connect to Telegram after multiple attempts');
                }
            });
        };
    } else {
        checkTelegramConnection().then(connected => {
            if (!connected) {
                console.log('Failed to connect to Telegram after multiple attempts');
            }
        });
    }

    document.getElementById('newChatBtn').addEventListener('click', function() {
        document.getElementById('newChatModal').style.display = 'flex';
    });

    document.getElementById('cancelNewChat').addEventListener('click', function() {
        document.getElementById('newChatModal').style.display = 'none';
        document.getElementById('chatNameInput').value = '';
    });

    document.getElementById('sendMessage').addEventListener('click', sendMessageHandler);
    document.getElementById('messageInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessageHandler();
        }
    });

    const navItems = document.querySelectorAll('.nav-item');
    navItems.forEach(item => {
        item.addEventListener('click', function(e) {
            e.preventDefault();
            
            const bottomNav = document.querySelector('.bottom-nav');
            bottomNav.style.display = 'flex'; // Ensure bottom nav is shown when switching tabs
            
            // Remove active class from all nav items
            navItems.forEach(nav => nav.classList.remove('active'));
            // Add active class to clicked item
            this.classList.add('active');
            
            // Get the page to show
            const page = this.getAttribute('data-page');
            
            // Hide all content sections
            document.querySelector('.container').style.display = 'none';
            document.getElementById('chatContent').style.display = 'none';
            document.getElementById('settingsContent').style.display = 'none';
            
            // Show the selected content
            switch(page) {
                case 'home':
                    document.querySelector('.container').style.display = 'block';
                    break;
                case 'chats':
                    document.getElementById('chatContent').style.display = 'block';
                    displayChats(); // Function to show saved chats
                    const chatInput = document.querySelector('.chat-input');
                    if (chatInput) {
                        chatInput.classList.add('with-nav'); // Ensure chat input is positioned correctly with nav
                    }
                    break;
                case 'settings':
                    document.getElementById('settingsContent').style.display = 'block';
                    break;
            }
        });
    });

    document.getElementById('createNewChat').addEventListener('click', createNewChat);

    function sendMessageHandler() {
        const input = document.getElementById('messageInput');
        const message = input.value.trim();
        
        if (message) {
            if (deductTokens(TOKENS_PER_MESSAGE)) {
                addMessage('Вы', message);
                input.value = '';
                setTimeout(() => {
                    addMessage('AI', 'Спасибо за ваше сообщение! Я обрабатываю ваш запрос.');
                }, 1000);
            } else {
                showNotification('Недостаточно токенов', 'error');
            }
        }
    }

    function addMessage(sender, text) {
        const messagesContainer = document.getElementById('messagesContainer');
        const messageDiv = document.createElement('div');
        messageDiv.className = `chat-message ${sender === 'AI' ? 'ai' : ''}`;
        messageDiv.textContent = `${sender}: ${text}`;
        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
}

async function checkTelegramConnection() {
    let attempts = 0;
    const maxAttempts = 5;
    
    const telegramIdSpan = document.getElementById('telegramId');
    
    // Try to wait for Telegram WebApp to initialize 
    while (attempts < maxAttempts) {
        try {
            // Check if Telegram WebApp is available
            if (window.Telegram?.WebApp) {
                window.tg = window.Telegram.WebApp;
                
                // Wait for initialization
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Check if user data is available
                if (window.tg.initDataUnsafe?.user?.id) {
                    const userId = window.tg.initDataUnsafe.user.id;
                    telegramIdSpan.textContent = userId;
                    return true;
                }
            }
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            attempts++;
            
            if (attempts === maxAttempts) {
                telegramIdSpan.textContent = translations.not_connected[currentLanguage];
            }
            
        } catch (err) {
            console.error('Error checking Telegram connection:', err);
            telegramIdSpan.textContent = translations.not_connected[currentLanguage];
        }
    }
    
    return false;
}

// Add this function to verify Telegram connection
function verifyTelegramConnection() {
    const telegramIdSpan = document.getElementById('telegramId');
    
    if (!window.Telegram?.WebApp?.initDataUnsafe?.user?.id) {
        telegramIdSpan.textContent = translations.not_connected[currentLanguage];
        return false;
    }
    
    const userId = window.Telegram.WebApp.initDataUnsafe.user.id;
    telegramIdSpan.textContent = userId;
    return true;
}

// Update the isTelegramConnected function
function isTelegramConnected() {
    return window.Telegram?.WebApp?.initDataUnsafe?.user?.id != null;
}

// Update the createNewChat function to properly handle chat creation and display
function createNewChat() {
    const telegramId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    
    if (!telegramId) {
        showNotification('Требуется подключение к Telegram', 'error');
        return;
    }
    
    const chatName = document.getElementById('chatNameInput').value.trim();
    if (chatName) {
        if (!deductTokens(TOKENS_PER_MESSAGE)) {
            showNotification('Недостаточно токенов', 'error');
            return;
        }
        
        const chatData = {
            name: chatName,
            id: Date.now(),
            messages: [],
            created: new Date().toISOString(),
            telegramId: telegramId
        };

        const storageKey = `chats_${telegramId}`;
        const chats = JSON.parse(localStorage.getItem(storageKey) || '[]');
        chats.push(chatData);
        localStorage.setItem(storageKey, JSON.stringify(chats));

        document.getElementById('newChatModal').style.display = 'none';
        document.getElementById('chatNameInput').value = '';
        
        displayChats();
        showChatMessages(chatData.id);
        showNotification('Чат создан', 'info');
    }
}

// Add admin panel functionality
function isAdmin() {
    const telegramId = window.Telegram?.WebApp?.initDataUnsafe?.user?.id;
    return ADMIN_IDS.includes(telegramId);
}

function showAdminPanel() {
    if (isAdmin()) {
        document.getElementById('adminPanel').style.display = 'block';
    }
}

function addTokens() {
    if (!isAdmin()) return;
    
    const userId = document.getElementById('targetUserId').value;
    const amount = parseInt(document.getElementById('tokenAmount').value);
    
    if (userId && amount) {
        let userTokens = parseInt(localStorage.getItem(`tokens_${userId}`) || '0');
        userTokens += amount;
        localStorage.setItem(`tokens_${userId}`, userTokens);
        showNotification(`Токены выданы пользователю ${userId}`, 'info');
    }
}

function addSubscription() {
    if (!isAdmin()) return;
    
    const userId = document.getElementById('subscriptionUserId').value;
    const days = parseInt(document.getElementById('subscriptionDays').value);
    
    if (userId && days) {
        const endDate = new Date();
        endDate.setDate(endDate.getDate() + days);
        localStorage.setItem(`subscription_${userId}`, endDate.toISOString());
        showNotification(`Подписка выдана пользователю ${userId}`, 'info');
    }
}

// Update initialize function to show admin panel
function initialize() {
    // Existing initialization code...
    
    if (isAdmin()) {
        showAdminPanel();
    }
    
    updateTokenDisplay();
}

document.addEventListener('DOMContentLoaded', () => {
    initialize();
    
    updateTimer();
    setInterval(updateTimer, 1000);
    
    const isDarkTheme = localStorage.getItem('darkTheme') === 'true';
    document.body.classList.toggle('dark-theme', isDarkTheme);
});

function updateTimer() {
    // Set initial values
    let endTime = new Date();
    endTime.setDate(endTime.getDate() + 3); // 3 days from now
    endTime.setHours(endTime.getHours() + 5); // Add 5 hours
    endTime.setMinutes(endTime.getMinutes() + 55); // Add 55 minutes
    endTime.setSeconds(endTime.getSeconds() + 3); // Add 3 seconds

    function updateDisplay() {
        const now = new Date();
        const diff = endTime - now;

        if (diff <= 0) {
            document.querySelector('.timer').textContent = '0d 0h 0m 0s';
            return;
        }

        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);

        document.querySelector('.timer').textContent = 
            `${days}d ${hours}h ${minutes}m ${seconds}s`;
    }

    // Update immediately and then every second
    updateDisplay();
    return setInterval(updateDisplay, 1000);
}

updateTimer();
</script></body></html>
